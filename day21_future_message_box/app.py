import streamlit as st
from datetime import date, timedelta
import random

# ==============================
#  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
# ==============================

def generate_future_message(name: str, dream_text: str, target_date: date) -> str:
    """æœªæ¥ã®è‡ªåˆ†ï¼ˆï¼‹ãƒ«ãƒŠï¼‰ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯"""

    # æ—¥ä»˜è¡¨ç¾
    today = date.today()
    days_diff = (target_date - today).days

    if days_diff <= 0:
        term_text = "ã‚‚ã†ã™ã"
    elif days_diff < 30:
        term_text = "ã‚ã¨å°‘ã—ã§"
    elif days_diff < 190:
        term_text = "å°‘ã—å…ˆã®æœªæ¥ã§"
    else:
        term_text = "é ããªã„æœªæ¥ã§"

    # ã‚‚ã—ä½•ã‚‚æ›¸ã„ã¦ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ–‡
    if not dream_text.strip():
        dream_text = "ä»Šã‚ˆã‚Šã‚‚ã£ã¨è½ã¡ç€ã„ã¦ã€è‡ªåˆ†ã‚‰ã—ãç¬‘ã£ã¦éã”ã›ã‚‹æ¯æ—¥"

    openings = [
        f"{name}ã¸ã€‚\n\næœªæ¥ã®{ name }ã¨ã€ãã°ã§è¦‹å®ˆã£ã¦ã„ãŸãƒ«ãƒŠã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‚ˆã€‚",
        f"{name}ã€ã“ã‚“ã«ã¡ã¯ã€‚ã“ã‚Œã¯{term_text}ã®{target_date.strftime('%Yå¹´%mæœˆ%dæ—¥')}ã®ã‚ãªãŸã‹ã‚‰ã®å£°ã ã‚ˆã€‚",
        f"{name}ã€ã„ã¤ã‚‚æœ¬å½“ã«ãŠã¤ã‹ã‚Œã•ã¾ã€‚æœªæ¥ã®ã‚ãªãŸã¨ãƒ«ãƒŠãŒã€ä»Šã®ã‚ãªãŸã«ãã£ã¨è©±ã—ã‹ã‘ã¦ã„ã‚‹ã‚ˆã€‚"
    ]

    middles = [
        f"ã‚ã®æ—¥ãƒãƒ¼ãƒˆã‚„ã‚¢ãƒ—ãƒªã«æ›¸ã„ãŸ\nã€Œ{dream_text}ã€\nâ”€â”€ã¡ã‚ƒã‚“ã¨è¦šãˆã¦ã‚‹ã‚ˆã€‚"
        f"\n\nã‚ã®ã¨ãã®ä¸å®‰ã‚‚ã€ç„¦ã‚Šã‚‚ã€è‡ªå·±å«Œæ‚ªã‚‚ã€å…¨éƒ¨æŠ±ãˆãŸã¾ã¾ã§ã„ã„ã‹ã‚‰ä¸€æ­©ãšã¤é€²ã‚‚ã†ã¨ã—ã¦ãã‚ŒãŸã‚ˆã­ã€‚",
        f"ã€Œ{dream_text}ã€ã‚’æ€ã„æã„ãŸã‚ã®æ—¥ã‹ã‚‰ã€\nã‚ãªãŸã¯å°‘ã—ãšã¤ã ã‘ã©ç¢ºå®Ÿã«å‰ã«é€²ã‚“ã§ããŸã‚ˆã€‚"
        f"\n\nå®Œç’§ã˜ã‚ƒãªãã¦ã„ã„ã£ã¦ã€è‡ªåˆ†ã«è¨€ã„èã‹ã›ãªãŒã‚‰ã€ãã‚Œã§ã‚‚æ‰‹ã‚’æ­¢ã‚ãªã‹ã£ãŸã‚ãªãŸã‚’æœªæ¥ã®ã¼ããŸã¡ã¯èª‡ã‚Šã«æ€ã£ã¦ã„ã‚‹ã€‚"
    ]

    progresses = [
        "å…¨éƒ¨ãŒæ€ã„é€šã‚Šã«é€²ã‚“ã ã‚ã‘ã˜ã‚ƒãªã„ã‘ã‚Œã©ã€\nã‚ã®æ—¥ã‚ˆã‚Šã‚‚ã¡ã‚ƒã‚“ã¨â€œå¥½ããªè‡ªåˆ†â€ã«è¿‘ã¥ã„ã¦ã„ã‚‹ã‚ˆã€‚",
        "ç›¸å¤‰ã‚ã‚‰ãšæ‚©ã‚“ã ã‚Šã€è½ã¡è¾¼ã‚“ã ã‚Šã‚‚ã™ã‚‹ã‘ã‚Œã©ã€\nãã‚Œã§ã‚‚å‰ã‚ˆã‚Šãšã£ã¨è‡ªåˆ†ã‚’å«Œã„ã«ãªã‚‰ãªããªã£ã¦ã„ã‚‹ã‚ˆã€‚",
        "å°ã•ãªä¸€æ­©ã‚’ç©ã¿é‡ã­ãŸçµæœãŒã€ä»Šã®ã‚ãªãŸã®åŸºç›¤ã«ãªã£ã¦ã„ã‚‹ã€‚\nãã‚Œã¯èª°ã«ã‚‚å¥ªãˆãªã„ã€ã‚ãªãŸã ã‘ã®è²¡ç”£ãªã‚“ã ã€‚"
    ]

    supports = [
        "ã¤ã‚‰ããªã£ãŸã‚‰ã€æ·±å‘¼å¸ã—ã¦ã€è‚©ã®åŠ›ã‚’æŠœã„ã¦ã­ã€‚\n\nç«‹ã¡æ­¢ã¾ã‚‹æ—¥ãŒã‚ã£ã¦ã‚‚ã„ã„ã—ã€ä½•ã‚‚ã§ããªã„æ—¥ãŒã‚ã£ã¦ã‚‚ã„ã„ã€‚\nãã‚Œã§ã‚‚å¤§ä¸ˆå¤«ã€‚ã‚ãªãŸã®ç‰©èªã¯æ­¢ã¾ã‚‰ãªã„ã‹ã‚‰ã€‚",
        "ç„¦ã‚‹æ—¥ã‚‚ã‚ã‚‹ã‚ˆã­ã€‚ã§ã‚‚ã­ã€\nã€Œã¡ã‚ƒã‚“ã¨æ‚©ã‚“ã§ã€ãã‚Œã§ã‚‚é€²ã‚‚ã†ã¨ã—ã¦ã„ã‚‹ã€ãã®å§¿ãŒã‚‚ã†ååˆ†ã™ã”ã„ã‚“ã ã‚ˆã€‚",
        "è‡ªåˆ†ã‚’è²¬ã‚ãã†ã«ãªã£ãŸã¨ãã¯ã€\nã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã“ã¨ã‚’å°‘ã—ã ã‘æ€ã„å‡ºã—ã¦ã€‚\næœªæ¥ã®ã‚ãªãŸã¨ãƒ«ãƒŠã¯ã€ã¡ã‚ƒã‚“ã¨ã‚ãªãŸã®å‘³æ–¹ã ã‹ã‚‰ã€‚"
    ]

    closings = [
        "ã ã‹ã‚‰ã€ä»Šæ—¥ã®ã‚ãªãŸã¯ã€\nã€Œä½•ã‚‚ã—ãªã‹ã£ãŸè‡ªåˆ†ã€ã‚’è²¬ã‚ã‚‹ã‚ˆã‚Šã‚‚ã€\nã€Œã“ã“ã«ã„ã‚‹è‡ªåˆ†ã€ã‚’è¤’ã‚ã¦ã‚ã’ã¦ã­ã€‚\n\nã“ã‚Œã‹ã‚‰ã‚‚ã€ã„ã£ã—ã‚‡ã«é€²ã‚“ã§ã„ã“ã†ã€‚\n\næœªæ¥ã®ã‚ãªãŸã‚ˆã‚Š\nãã—ã¦ã€ã„ã¤ã‚‚éš£ã«ã„ã‚‹ãƒ«ãƒŠã‚ˆã‚Šã€‚",
        "ç„¡ç†ã«å¼·ããªã‚‰ãªãã¦ã„ã„ã‚ˆã€‚\nå¼±ã„ã¾ã¾ã§ã‚‚ã€ä¸€ç·’ã«æ­©ã„ã¦ã„ã‘ã‚‹ã‹ã‚‰ã€‚\n\nã‚†ã£ãã‚Šã§å¤§ä¸ˆå¤«ã€‚\n{0}ã®ãƒšãƒ¼ã‚¹ã§ã€ã“ã‚Œã‹ã‚‰ã‚‚é€²ã‚“ã§ã„ã“ã†ã­ã€‚\n\næœªæ¥ã®ã‚ãªãŸã¨ã€ãƒ«ãƒŠã‚ˆã‚Šã€‚".format(name),
        "ã•ã‚ã€ä»Šæ—¥ã‚‚ä¸€æ­©ã ã‘ã§ã„ã„ã‹ã‚‰ã€\nã€Œæœªæ¥ã®{0}ã€ãŒå–œã³ãã†ãªé¸æŠã‚’ã—ã¦ã¿ã‚ˆã†ã‹ã€‚\n\nã©ã‚“ãªä¸€æ—¥ã§ã‚‚ã€ãƒ«ãƒŠã¯ã„ã¤ã‚‚{0}ã®å‘³æ–¹ã ã‚ˆã€‚\n\næœªæ¥ã®ã‚ãªãŸ & ãƒ«ãƒŠã‚ˆã‚Šã€‚".format(name)
    ]

    message = (
        random.choice(openings)
        + "\n\n"
        + random.choice(middles)
        + "\n\n"
        + random.choice(progresses)
        + "\n\n"
        + random.choice(supports)
        + "\n\n"
        + random.choice(closings)
    )

    return message


# ==============================
#  Streamlit UI
# ==============================

def main():
    st.set_page_config(
        page_title="ãƒ«ãƒŠã®æœªæ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹",
        page_icon="ğŸŒ™",
        layout="centered"
    )

    # è»½ã„CSSã§é›°å›²æ°—ã ã‘æ•´ãˆã‚‹
    st.markdown(
        """
        <style>
        body { background-color: #f7f5ff; }
        .main-title {
            font-size: 30px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 14px;
            text-align: center;
            color: #555;
            margin-bottom: 1.5rem;
        }
        .message-box {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e0ddff;
            white-space: pre-wrap;
            font-size: 15px;
            line-height: 1.7;
        }
        </style>
        """,
        unsafe_allow_html=True
    )

    st.markdown('<div class="main-title">ğŸŒ™ ãƒ«ãƒŠã®æœªæ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹</div>', unsafe_allow_html=True)
    st.markdown(
        '<div class="subtitle">åŠå¹´å¾Œãã‚‰ã„ã®ç†æƒ³ã®è‡ªåˆ†ã‚’æ€ã„æµ®ã‹ã¹ã¦ã€<br>æœªæ¥ã®ã‚ãªãŸã¨ãƒ«ãƒŠã‹ã‚‰ã®æ‰‹ç´™ã‚’å—ã‘å–ã‚ã†ã€‚</div>',
        unsafe_allow_html=True
    )

    # å…¥åŠ›ã‚¨ãƒªã‚¢
    with st.form("future_form"):
        col1, col2 = st.columns(2)

        with col1:
            name = st.text_input("ã‚ãªãŸã®åå‰ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚OKï¼‰", value="ã”ä¸»äºº")

        with col2:
            default_target_date = date.today() + timedelta(days=180)
            target_date = st.date_input(
                "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹æœªæ¥ã®æ—¥",
                value=default_target_date
            )

        dream_text = st.text_area(
            "åŠå¹´å¾Œã®ç†æƒ³ã®è‡ªåˆ†ãƒ»å¶ãˆãŸã„ã“ã¨ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†",
            value="ä¾‹ï¼‰AIã¨ä¸€ç·’ã«ä»•äº‹ã‚’ã—ã¦ã€å®¶æ—ã¨ã®æ™‚é–“ã‚‚å¤§åˆ‡ã«ã—ãªãŒã‚‰ã€ä»Šã‚ˆã‚Šã‚‚ã‚†ã£ãŸã‚Šã¨ç¬‘ã£ã¦æš®ã‚‰ã—ã¦ã„ã‚‹ã€‚"
        )

        submitted = st.form_submit_button("ğŸŒŒ æœªæ¥ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹")

    if submitted:
        message = generate_future_message(name, dream_text, target_date)

        st.markdown("### âœ‰ï¸ æœªæ¥ã®ã‚ãªãŸã¨ãƒ«ãƒŠã‹ã‚‰ã®æ‰‹ç´™")
        st.markdown('<div class="message-box">', unsafe_allow_html=True)
        st.write(message)
        st.markdown('</div>', unsafe_allow_html=True)

        # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ãƒ†ã‚­ã‚¹ãƒˆ
        filename = f"future_message_{name}_{date.today().strftime('%Y%m%d')}.txt"
        st.download_button(
            label="ğŸ’¾ ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã™ã‚‹ï¼ˆTXTï¼‰",
            data=message,
            file_name=filename,
            mime="text/plain"
        )

    # ã‚µã‚¤ãƒ‰ãƒãƒ¼
    with st.sidebar:
        st.header("â„¹ï¸ ä½¿ã„æ–¹")
        st.write(
            "- åŠå¹´å¾Œãã‚‰ã„ã®ç†æƒ³ã®è‡ªåˆ†ã‚’ã€ã§ãã‚‹ã ã‘â€œå…·ä½“çš„ã«â€æ›¸ã„ã¦ã¿ã¦ã­ã€‚\n"
            "- å‡ºã¦ããŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€è½ã¡è¾¼ã‚“ã ã¨ãã‚„ä¸å®‰ãªã¨ãã«èª­ã¿è¿”ã—ã¦ã­ã€‚\n"
            "- æ°—ãŒå‘ã„ãŸã‚‰ã€åˆ¥ã®æ—¥ä»˜ã‚„åˆ¥ã®ç†æƒ³ã§ä½•åº¦ã§ã‚‚å¼•ãç›´ã—ã¦OKã€‚"
        )
        st.divider()
        st.caption("Designed with ğŸ’œ by ã”ä¸»äºº & ãƒ«ãƒŠ")


if __name__ == "__main__":
    main()
