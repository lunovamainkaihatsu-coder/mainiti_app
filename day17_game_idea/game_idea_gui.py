import random
import PySimpleGUI as sg

# -------------------------
# ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆStreamlitç‰ˆã¨åŒã˜ï¼‰
# -------------------------
GENRES = [
    "ãƒŸãƒ‹ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°",
    "è½ã¡ã‚‚ã®ãƒ‘ã‚ºãƒ«",
    "ãƒªã‚ºãƒ ã‚²ãƒ¼ãƒ ",
    "åå°„ç¥çµŒã‚²ãƒ¼ãƒ ",
    "ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
    "è¿·è·¯ã‚²ãƒ¼ãƒ ",
    "ã‚¿ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹é¢¨",
    "ãƒ©ãƒ³ã‚²ãƒ¼ãƒ ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰",
    "ã‚¯ãƒªãƒƒã‚¯é€£æ‰“ã‚²ãƒ¼ãƒ ",
    "ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç³»ã‚²ãƒ¼ãƒ ",
]

CONSTRAINTS = [
    "1ç”»é¢ã ã‘ã§å®Œçµã•ã›ã‚‹",
    "æ“ä½œã¯ãƒœã‚¿ãƒ³1ã¤ã ã‘ã«ã™ã‚‹",
    "æ•µï¼ˆã¾ãŸã¯éšœå®³ç‰©ï¼‰ã¯3ç¨®é¡ä»¥å†…ã«ã™ã‚‹",
    "1ãƒ—ãƒ¬ã‚¤30ç§’ä»¥å†…ã§çµ‚ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹",
    "ã‚¹ã‚³ã‚¢ã‹ã‚¿ã‚¤ãƒ ã®ã©ã¡ã‚‰ã‹ã ã‘ã‚’ä½¿ã†",
    "ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ä¸€åˆ‡å…¥ã‚Œãªã„ï¼ˆç›´æ„Ÿã§éŠã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰",
    "ã‚µã‚¦ãƒ³ãƒ‰ãªã—ã§ã‚‚æˆã‚Šç«‹ã¤ã‚ˆã†ã«ä½œã‚‹",
    "UIã®ãƒœã‚¿ãƒ³ã¯3ã¤ä»¥å†…ã«ãŠã•ã‚ã‚‹",
    "èƒŒæ™¯ã¯å˜è‰²ã‹ã‚°ãƒ©ãƒ‡ã ã‘ã«ã™ã‚‹",
    "ãƒ«ãƒ¼ãƒ«èª¬æ˜ã¯ä¸€æ–‡ã ã‘ã§ä¼ãˆã‚‹",
]

TWISTS = [
    "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨æ•µã®ç«‹å ´ãŒé€”ä¸­ã§å…¥ã‚Œæ›¿ã‚ã‚‹",
    "ãƒŸã‚¹ã™ã‚‹ã¨é€†ã«ã‚¹ã‚³ã‚¢ãŒå¢—ãˆã‚‹ãªã©â€œé€†å¼µã‚Šãƒ«ãƒ¼ãƒ«â€ã‚’1ã¤å…¥ã‚Œã‚‹",
    "ä¸€å®šæ™‚é–“ã”ã¨ã«ç”»é¢ã®è‰²ãŒã‚¬ãƒ©ãƒƒã¨å¤‰ã‚ã‚‹æ¼”å‡ºã‚’å…¥ã‚Œã‚‹",
    "ãƒ©ã‚¹ãƒˆ5ç§’ã ã‘è¶…ãƒã‚¤ãƒ†ãƒ³ãƒã«ãªã‚‹ãƒ¢ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã‚‹",
    "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«â€œæ¬¡ã®ãƒ’ãƒ³ãƒˆâ€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹",
    "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ”»æ’ƒï¼ˆã¾ãŸã¯æ“ä½œï¼‰ãŒã ã‚“ã ã‚“æš´èµ°ã—ã¦ã„ãè¡¨ç¾ã‚’å…¥ã‚Œã‚‹",
    "ã‚¹ã‚³ã‚¢ã§ã¯ãªãâ€œå¤±æ•—å›æ•°â€ã§æˆé•·ã—ã¦ã„ãè¦ç´ ã‚’å…¥ã‚Œã‚‹",
    "ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã«ã¡ã‚‡ã£ã¨ã—ãŸéš ã—ã‚®ãƒŸãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹",
    "ã‚²ãƒ¼ãƒ ä¸­ã«ä¸€åº¦ã ã‘â€œå¥‡è·¡ã®é€†è»¢ãƒãƒ£ãƒ³ã‚¹â€ã‚’ç”¨æ„ã™ã‚‹",
    "ãƒ—ãƒ¬ã‚¤ã”ã¨ã«ãƒ«ãƒ¼ãƒ«ãŒå°‘ã—ã ã‘å¤‰åŒ–ã™ã‚‹â€œæ°—ã¾ãã‚Œãƒ«ãƒ¼ãƒ«â€ã‚’å…¥ã‚Œã‚‹",
]

TOOLS_HINTS = [
    "2Dã‚²ãƒ¼ãƒ ãªã‚‰ Unity ã‹ Godot ã‚ãŸã‚ŠãŒä½œã‚Šã‚„ã™ãã†ã€‚",
    "ãƒ–ãƒ©ã‚¦ã‚¶ã‚²ãƒ¼ãƒ ã«ã™ã‚‹ãªã‚‰ HTML5 + JavaScript ã‹ Python + pygame ã‚‚ã‚¢ãƒªã€‚",
    "ã‚¹ã‚³ã‚¢ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ã‚²ãƒ¼ãƒ ãªã‚‰ Streamlit ã§ã‚‚æ„å¤–ã¨ã‚¤ã‚±ã‚‹ã€‚",
    "ã¾ãšã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ã‚ã¡ã‚ƒã‚·ãƒ³ãƒ—ãƒ«ã«ä½œã£ã¦ã‹ã‚‰ã€æ¼”å‡ºã ã‘è¶³ã—ã¦ã„ãã¨æ¥½ã€‚",
    "1æ—¥1æœ¬ãŒç›®æ¨™ã ã‹ã‚‰ã€ã¾ãšã¯â€œå‹•ãâ€ã“ã¨ã‚’æœ€å„ªå…ˆã«ã—ã‚ˆã†ã€‚",
]


def make_title(genre: str, constraint: str) -> str:
    bases = [
        f"{genre}ï¼š{constraint.split('ã€')[0]}",
        f"{genre}ãƒ»ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼",
        f"{genre} 30sec",
        f"ONE BUTTON {genre}",
        f"Crazy {genre}",
        f"{genre} Re:Mix",
    ]
    return random.choice(bases)


def estimate_difficulty(genre: str, constraint: str) -> str:
    score = 0
    if "ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°" in genre or "ã‚¿ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹" in genre:
        score += 2
    if "è¿·è·¯" in genre or "ãƒ©ãƒ³ã‚²ãƒ¼ãƒ " in genre:
        score += 1
    if "æ“ä½œã¯ãƒœã‚¿ãƒ³1ã¤ã ã‘" in constraint:
        score -= 1
    if "1ç”»é¢ã ã‘ã§å®Œçµ" in constraint:
        score -= 1

    if score <= 0:
        return "â˜…â˜†â˜†ï¼šä»Šæ—¥ã®1æœ¬ç›®ã«ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¤ãƒˆé›£æ˜“åº¦ã€‚"
    elif score == 1:
        return "â˜…â˜…â˜†ï¼šå°‘ã—ã ã‘è€ƒãˆã‚‹è¦ç´ ã‚ã‚Šã€‚ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã«æœ€é©ã€‚"
    else:
        return "â˜…â˜…â˜…ï¼šã—ã£ã‹ã‚Šä½œã‚Šè¾¼ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚2ã€œ3æ—¥ã«åˆ†ã‘ã¦ã‚‚OKã‹ã‚‚ã€‚"


def generate_text() -> str:
    genre = random.choice(GENRES)
    constraint = random.choice(CONSTRAINTS)
    twist = random.choice(TWISTS)
    title = make_title(genre, constraint)
    diff_text = estimate_difficulty(genre, constraint)
    tool_hint = random.choice(TOOLS_HINTS)

    lines = []
    lines.append("ğŸ® æ¯æ—¥ã‚²ãƒ¼ãƒ ãŠé¡Œãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆï¼‰")
    lines.append("-" * 40)
    lines.append(f"â–  ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ\n  {title}\n")
    lines.append(f"â–  ã‚¸ãƒ£ãƒ³ãƒ«\n  {genre}\n")
    lines.append(f"â–  åˆ¶ä½œã®â€œç¸›ã‚Šâ€\n  {constraint}\n")
    lines.append(f"â–  ã²ã¨ã²ã­ã‚Šã‚¢ã‚¤ãƒ‡ã‚¢\n  {twist}\n")
    lines.append(f"â–  é›£æ˜“åº¦ã‚¤ãƒ¡ãƒ¼ã‚¸\n  {diff_text}\n")
    lines.append(f"â–  é–‹ç™ºãƒ¡ãƒ¢\n  {tool_hint}\n")
    lines.append("â€»æ°—ã«å…¥ã‚‰ãªã‹ã£ãŸã‚‰ã€ã‚‚ã†ä¸€åº¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ã€‚")
    return "\n".join(lines)


def main():
    sg.theme("DarkBlue3")

    layout = [
        [sg.Text("ğŸ® æ¯æ—¥ã‚²ãƒ¼ãƒ ãŠé¡Œãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆï¼‰")],
        [sg.Multiline(
            size=(60, 20),
            key="-OUT-",
            disabled=True,
            font=("Meiryo", 10)
        )],
        [
            sg.Button("ãŠé¡Œç”Ÿæˆ", key="-GEN-", size=(12, 1)),
            sg.Button("çµ‚äº†", key="-EXIT-", size=(8, 1)),
        ],
    ]

    window = sg.Window("ã‚²ãƒ¼ãƒ ãŠé¡Œãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆï¼‰", layout, resizable=True)

    # èµ·å‹•æ™‚ã«1å›ç”Ÿæˆã—ã¦ãŠã
    window["-OUT-"].update(generate_text())

    while True:
        event, values = window.read()
        if event in (sg.WIN_CLOSED, "-EXIT-"):
            break
        if event == "-GEN-":
            window["-OUT-"].update(generate_text())

    window.close()


if __name__ == "__main__":
    main()
