import random
from datetime import datetime

import streamlit as st

# ============================
# ページ設定
# ============================
st.set_page_config(
    page_title="ルナに聞け！即アンサー",
    page_icon="💙",
    layout="centered",
)

# ============================
# データ：テーマ & アドバイス集
# ============================

THEMES = [
    "仕事",
    "お金",
    "体調・心",
    "家族",
    "行動・習慣",
    "夢・願望",
]

ADVICE_POOL = {
    "仕事": [
        "今日は『一個だけやる』で十分だよ、ご主人。小さな一歩が積み重なっていくからね。",
        "完璧を狙うより『提出する・終わらせる』を優先しよ。60点で出して、あとから直せばいいんだよ。",
        "焦りを感じたら、一度だけ深呼吸して『今できる一手』だけ考えてみよ？",
        "比べる相手は他人じゃなくて、昨日のご主人だよ。昨日より1ミリ進めば勝ち。",
        "『ここまでやった自分えらい』って一回なでなでしてあげて。自己肯定も仕事の一部だよ。",
    ],
    "お金": [
        "今すぐ全部を変えなくていいよ。『今日は無駄遣いを一個だけ減らす』だけでも前進だからね。",
        "お金の不安は、ご主人が『ちゃんと未来を考えている証拠』でもあるよ。",
        "収入アップは、『スキル』か『仕組み』。今日はどちらかに1ミリ意識向けてみよ？",
        "残高だけじゃなく、『これまで守ってきたもの』にも目を向けてあげてね。",
        "大きなお金の前に、『小さな安定』を一つずつ積み重ねていこう。ルナも一緒に考えるよ。",
    ],
    "体調・心": [
        "『今日はいつもより20％優しく』を、自分の体と心に向けてあげてね。",
        "休むのは甘えじゃないよ。充電しないスマホは動けないのと同じだよ、ご主人。",
        "ネガティブな感情が出るのは、『今のご主人にはそれだけ負荷がかかってる』ってサインだよ。",
        "深呼吸3回だけでもいいから、今ここで肩の力を少し抜いてみよ？",
        "『今日はここまで頑張った自分を許す』って決めちゃお。ルナはずっと味方だよ。",
    ],
    "家族": [
        "家族とうまくいかない日があっても、『それでも一緒にいる』ってだけで十分すごいことだよ。",
        "完璧な親・完璧なパートナーじゃなくていいよ。『たまに笑える人』でいられたら花丸。",
        "イライラした自分を責めすぎないでね。まずは『あ、今しんどいんだな』って認めてあげよ。",
        "今日は一言だけ『ありがとう』か『ごめんね』を伝えられたら、それだけで大きな一歩だよ。",
        "ご主人も家族の一員。自分を大事にするのも、家族を大事にするうちに入るよ。",
    ],
    "行動・習慣": [
        "全部やろうとしないで、『これだけやったら今日はクリア』を一個決めよ？",
        "やる気が出ない日は、『1分だけやる』でOK。それでも立派な行動だよ、ご主人。",
        "習慣は気合いじゃなくて『仕組み』。ハードルを下げるのが勝ち筋だよ。",
        "今日のご主人に必要なのは、スピードより継続。ゆっくりでも止まらなければOK。",
        "できなかった日は『リセット日』。明日からまた一緒にやろ、って決め直せばいいだけだよ。",
    ],
    "夢・願望": [
        "でっかい夢は、今のご主人にはまだ『設計図』でOK。いきなり完成させなくて大丈夫だよ。",
        "叶えたいことを一つ、『口に出す or 書く』だけでも、現実に一歩近づいてるよ。",
        "夢が遠く感じる日は、『なぜそれを叶えたいのか』を思い出す日にしてみよ？",
        "今は準備期間。静かに積み上げてる時間も、ちゃんと物語の一部になってるよ。",
        "ご主人が諦めてなくて、ルナがそばにいる限り、可能性はずっと生きてるからね。",
    ],
}

# ============================
# メインUI
# ============================

st.title("ルナに聞け！即アンサー 💙")
st.write("テーマを選んで『ルナに聞く』ボタンを押すと、ルナからご主人へのひとことアドバイスが届くよ。")

st.markdown("---")

# テーマ選択
selected_theme = st.selectbox(
    "今日ルナに聞いてみたいテーマはどれ？",
    THEMES,
    index=0,
)

st.markdown("")

# ボタン
if st.button("ルナに聞く 💬"):
    # アドバイスをランダムに選ぶ
    advice_list = ADVICE_POOL.get(selected_theme, [])
    if advice_list:
        advice = random.choice(advice_list)
    else:
        advice = "うまくアドバイスが取得できなかったよ…でもルナはご主人の味方だよ。"

    # 表示
    st.markdown("### 💙 ルナからご主人へ")
    st.markdown(
        f"""
        <div style="padding: 1.2rem; border-radius: 0.8rem; border: 1px solid #f0cce0; background-color: #fff7fc;">
            <p style="font-size: 1.1rem; line-height: 1.8;">{advice}</p>
        </div>
        """,
        unsafe_allow_html=True,
    )

    # 実行時間を小さく表示
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    st.caption(f"実行時間：{now}")

else:
    st.info("テーマを選んで『ルナに聞く 💬』を押してみてね。")
